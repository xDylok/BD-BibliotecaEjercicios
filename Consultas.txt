------ CONSULTAS 
1.
SELECT p.Nombres AS nombre_paciente, p.Apellidos AS apellido_paciente, d.Nombres AS nombre_doctor, d.Especialidad, s.Nombre AS nombre_sucursal, c.Fecha,  c.Motivo FROM CITA c JOIN PACIENTE p ON c.ID_Paciente_fk = p.ID_Paciente; 


SELECT p.Nombres AS nombre_paciente, p.Apellidos AS apellido_paciente, d.Nombres AS nombre_doctor, d.Especialidad, s.Nombre AS nombre_sucursal, c.Fecha,  c.Motivo FROM CITA c JOIN PACIENTE p ON c.ID_Paciente_fk = p.ID_Paciente JOIN DOCTOR d ON c.ID_Doctor_fk = d.ID_Doctor JOIN SUCURSAL s ON d.ID_Sucursal_fk = s.ID_Sucursal WHERE c.Estado = 'Completada'; 

CREATE VIEW view_citas_completadas_detalle AS SELECT p.Nombres AS nombre_paciente, p.Apellidos AS apellido_paciente, d.Nombres AS nombre_doctor, d.Especialidad, s.Nombre AS nombre_sucursal, c.Fecha,  c.Motivo FROM CITA c JOIN PACIENTE p ON c.ID_Paciente_fk = p.ID_Paciente JOIN DOCTOR d ON c.ID_Doctor_fk = d.ID_Doctor JOIN SUCURSAL s ON d.ID_Sucursal_fk = s.ID_Sucursal WHERE c.Estado = 'Completada'; 


2.
SELECT p.Nombres, p.Apellidos, SUM(t.Costo) AS costo_total_gastado FROM PACIENTE p JOIN CITA c ON p.ID_Paciente = c.ID_Paciente_fk JOIN TRATAMIENTO t ON c.ID_Cita = t.ID_Cita_fk GROUP BY p.ID_Paciente, p.Nombres, p.Apellidos;

CREATE VIEW view_costo_total_por_paciente AS SELECT p.Nombres, p.Apellidos, SUM(t.Costo) AS costo_total_gastado FROM PACIENTE p JOIN CITA c ON p.ID_Paciente = c.ID_Paciente_fk JOIN TRATAMIENTO t ON c.ID_Cita = t.ID_Cita_fk GROUP BY p.ID_Paciente, p.Nombres, p.Apellidos;

3.
SELECT Nombres, Apellidos, Correo FROM PACIENTE WHERE ID_Paciente NOT IN (SELECT DISTINCT ID_Paciente_fk FROM CITA  WHERE Estado = 'Programada');

CREATE VIEW view_pacientes_sin_citas_programadas AS SELECT Nombres, Apellidos, Correo FROM PACIENTE WHERE ID_Paciente NOT IN (SELECT DISTINCT ID_Paciente_fk FROM CITA  WHERE Estado = 'Programada');

4.
SELECT p.Nombres, p.Apellidos, COUNT(t.ID_Tratamiento) AS Conteo_Total_Tratamientos FROM PACIENTE p LEFT JOIN CITA c ON p.ID_Paciente = c.ID_Paciente_fk LEFT JOIN TRATAMIENTO t ON c.ID_Cita = t.ID_Cita_fk GROUP BY p.ID_Paciente, p.Nombres, p.Apellidos;

CREATE VIEW view_conteo_tratamientos_por_paciente AS SELECT p.Nombres, p.Apellidos, COUNT(t.ID_Tratamiento) AS Conteo_Total_Tratamientos FROM PACIENTE p LEFT JOIN CITA c ON p.ID_Paciente = c.ID_Paciente_fk LEFT JOIN TRATAMIENTO t ON c.ID_Cita = t.ID_Cita_fk GROUP BY p.ID_Paciente, p.Nombres, p.Apellidos;

5.

SELECT DISTINCT c_sub.Fecha FROM CITA c_sub JOIN PACIENTE p_sub ON c_sub.ID_Paciente_fk = p_sub.ID_Paciente WHERE p_sub.Nombres = 'Jostin' AND p_sub.Apellidos = 'Perez';

SELECT DISTINCT p.Nombres, p.Apellidos, p.Telefono, c.Fecha FROM PACIENTE p JOIN CITA c ON p.ID_Paciente = c.ID_Paciente_fk WHERE c.Fecha IN (SELECT DISTINCT c_sub.Fecha FROM CITA c_sub JOIN PACIENTE p_sub ON c_sub.ID_Paciente_fk = p_sub.ID_Paciente WHERE p_sub.Nombres = 'Jostin' AND p_sub.Apellidos = 'Perez') AND p.Nombres != 'Jostin';

CREATE VIEW view_pacientes_cita_mismo_dia_jostin AS SELECT DISTINCT p.Nombres, p.Apellidos, p.Telefono, c.Fecha FROM PACIENTE p JOIN CITA c ON p.ID_Paciente = c.ID_Paciente_fk WHERE c.Fecha IN (SELECT DISTINCT c_sub.Fecha FROM CITA c_sub JOIN PACIENTE p_sub ON c_sub.ID_Paciente_fk = p_sub.ID_Paciente WHERE p_sub.Nombres = 'Jostin' AND p_sub.Apellidos = 'Perez') AND p.Nombres != 'Jostin';


